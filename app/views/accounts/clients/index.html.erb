<% provide(:title, t('clients.list')) %>

<%= render layout: 'layouts/breadcrumb', locals: {path: [{:title => t('clients.index.breadcrumb'), :href => clients_path}], icon: 'house-colored', index: true} do %>
  <div class="action-btns">
    <%= link_to new_client_path, class: 'btn btn-primary btn-sm' do %>
      <i class="fas fa-plus-circle fa-fw"></i><span class="d-none d-md-inline">&nbsp;<%= t('clients.new.add_button') %></span>
    <% end %>
  </div>
<% end %>

<div class="page-container">
  <div class="container">
    <div class="app-container">
      <%# Here we call render not on a string with the name of a partial, but rather on a user variable of class User;
          in this context, Rails automatically looks for a partial called _user.html.erb, which we must create.
          This is a definite improvement, but we can do even better: we can call render directly on the @users variable
          Here Rails infers that @users is a list of User objects; moreover, when called with a collection of users,
          Rails automatically iterates through them and renders each one with the _user.html.erb partial
          (inferring the name of the partial from the name of the class). %>
      <%#= render @users %>
      <%= react_component('ClientsListWithDatatable', props: {
          initial_payload: {
              dataset_wrapper: @personslist,
              results_per_page: @results_per_page,
              total_entries: @total_entries,
              current_page: @current_page,
              initial_search: @initial_search,
              initial_sorting: @initial_sorting,
              initial_ordering: @initial_ordering,
              object_type: 'clients',
              clients_path: clients_path,
              cfields: {
                fields: get_cfields('clients'),
                storedSelections: @initial_cfields,
                options: cfields_options,
                nocfieldsimg: asset_pack_path('media/images/no_content.svg')
      },
          },
          i18n: {
              datatable: t('js.datatables.clients'),
              result_count: t('js.datatables.pagination.results'),
              no_results: t('js.datatables.clients.no_results'),
              search: t('js.datatables.clients.search_placeholder'),
              clear: t('js.datatables.clear'),
              filters: {
                  title: t('js.datatables.filters.title'),
                  nocfields_html: t('js.datatables.filters.nocfields_html',
                               cfields_link: edit_model_type_path(current_account.model_types.find_by(name: 'clients').id)),
                  status: {
                      title: t('js.datatables.filters.status.title'),
                      active: t('js.datatables.filters.status.active'),
                      inactive: t('js.datatables.filters.status.inactive')
                  }
              },
              modal: {
                  mass_actions: {
                      title: t('js.components.modal.mass_actions.title'),
                      close_btn: t('js.components.modal.mass_actions.close_btn'),
                  }
              },
              cfields: {
                  select_prompt: t('cfields.choose'),
                  text_prompt: t('cfields.text_placeholder')
              }
          },
          meta: {
              is_admin: current_user.is_admin?(current_account),
              freeze_link:  toggle_activation_user_url('USERID'),
              mass_delete_clients_link: mass_delete_clients_url,
              mass_freeze_clients_link: mass_freeze_clients_url,
          }
      }, prerender: false) %>
      <div class="clearfix"></div>
    </div>
  </div>
</div>